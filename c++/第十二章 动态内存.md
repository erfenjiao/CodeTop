# 前言

前面使用过静态内存和栈内存。静态内存用来保存局部static对象、类static数据成员以及定义在任何函数之外的变量。  栈内存用于保存定义在函数内的非static对象。分配在静态内存和栈内存中的对象由编译器自动创建和销毁。

对于栈对象，仅在其定义的程序块运行时存在；static对象在使用之前分配，在结束时销毁。

除了自动和static对象以外，c++还支持动态分配对象。动态分配的对象的生存期由程序控制，与他们在哪里创建无关。只有当显式的释放时，这些对象才会被销毁。



# 12.1 动态内存与智能指针

在c++中，动态内存的管理是通过一对运算符 new delete完成的

>  new：在动态内存中为对象分配空间并返回一个指向该对象的指针，我们可以选择对对象进行初始化
>
> delete：接受一个动态对象的指针，销毁该对象，并释放与之关联的内存  

为了更安全的使用动态内存，新的标准库提供了两种智能指针类型来管理动态对象。智能指针的行为类似常规指针，重要的区别就是它负责自动释放所指向的对象。

新的标准库提供的这两种智能指针的区别在于管理底层指针的方式。

shared_ptr：允许多个指针指向同一个对象

unique_ptr：独占所指向的对象

weak_ptr：shared_ptr 的伴随类，是一种弱引用，指向 shared_ptr所管理的对象                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  

## 12.1.1 shared_ptr 类

c++语言既有类模板，也有函数模板，其中vector是类模板。类似 vector，智能指针也是模板。

#### make_shared 函数

最安全的分配和使用动态内存的方法：调用一个名为make_shared的标准库函数。

比较简单的，用auto来定一个对象来保存make_shared的结果：

> aut p = make_shared<vector<string>>();

#### shared_ptr 的拷贝构造和赋值

引用计数，计数器变为0,自动释放自己所管理的对象

#### shared_ptr 自动销毁所管理的对象，还会自动释放相关内存

通过析沟函数完成销毁工作,并释放资源

#### 使用动态生存期的资源类

1. 程序不知道自己会使用多少对象
2. 程序不知道所需对象的准确类型
3. 程序需要在多个对象之间共享数据

使用动态内存是为了让多个对象能共享相同的底层数据。



